<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Chevrez</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.0.0/jquery.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
  <link rel="stylesheet" href="../public/css/style.css">
  <link rel="stylesheet" href="../public/css/post.css">

  <!--MODAL-->
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.1/jquery.modal.min.css" />
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.0.0/jquery.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery-modal/0.9.1/jquery.modal.min.js"></script>
</head>
<body id="body">
<div class="main">
  <div class="nav">
    <div class="bar"></div>
    <div class="info">
      <img src="https://ichef.bbci.co.uk/ace/standard/976/cpsprodpb/16620/production/_91408619_55df76d5-2245-41c1-8031-07a4da3f313f.jpg">
      <span>
        {{#if userName }}
          Hola otra vez,<br/>
          <span class="name-perfil"><a href="/perfil/{{userName}}">{{userName}}</a></span>
          {{else}}
          Hola extraÃ±@
        {{/if}}
      </span>
      <div class="info2">
        {{#if userName}}
          <span>Bienvenido a Chevrez</span>
        {{else}}
          <span>No tienes una cuenta</span>
          <span>Registrate pues hijit@...</span>
        {{/if}}
        </div>
        {{#if userName}}
        {{else}}
      <div class="register-btn"> 
          <a href="/index/register">Registrate</a>
          <a href="/index/login">Login</a>
      </div>
      {{/if}}
    </div>
  </div>
  <div class="centro">
    <div class="title">
      <a href="/index"><img src="../public/image/name.png"></a>
      <div class="nav-centro">
        <a href="/index">Home</a>
        <a href="/index/team">Team info</a>
        <a href="">Cool Stuff</a>
      </div>
    </div>
    <div class="nav-bar">
      <span>Chevrez Posts</span>
      {{#if userName}}
        <b><a href="/perfil/{{userName}}">My Perfil</a></b>
      {{else}}
        <div class="nav-mobile">
          <a href="/index/register">Registrate</a> /
          <a href="/index/login">Login</a>
        </div>
      {{/if}}
    </div>
    <div class="public">
      <div class="post">
        <div class="post-title">
          <!--<div class="post-title"><a href="/posts/{{publi._id}}">{{publi.title}}</a></div>-->
        </div>

          <div class="info-public">
            <div class="aea2">
              <div class="image-public">
                <img src="http://gravatar.com/avatar/{{publi.user_id.gravatar}}?d=monsterid&s=300">
              </div>
              <div class="ga">
                <span class="info-public-name" id="info-publi">
                  {{publi.user_id.name}}ðŸ—¿ <span class="info-public-name-arroba">@{{publi.user_id.name}}</span>
                  {{#if adminName}}
                    <span class="ellip"><a href="#ex2" rel="modal:open"><i id="comment" class="fa-solid fa-ellipsis"></i></a></span>
                  {{/if}}
                </span>
                <span class="date">Hace {{timeago publi.timestamp}}</span>
              </div>
            </div>
            <span id="parr" class="parr_post">{{publi.parr}}</span>
            {{#if publi.filename}}
              <div class="box-image-bd">
                <img class="image-bd" src="/public/upload/{{publi.filename}}">
              </div>
            {{/if}}
          </div>
          <!--
        <div class="footer-post">
          <div>
            <span class="autor">Por {{publi.user_id.name}}</span> | <span class="date">[Hace {{timeago publi.timestamp}}]</span>
            <span class="date"><span style="color: gold;">Publicado hace</span> [{{timeago publi.timestamp}}]</span>
          </div>
        </div>
        -->
      </div>
      <div class="box-interac" style="margin-top: 10px;">
        <i class="fa-regular fa-heart"></i>
        <a href="#ex1" rel="modal:open"><i id="comment" class="fa-regular fa-comment"></i><span class="coment-length">{{this.comments.length}}</span></a>
        <span id="compartir" onclick="copyLinkToClipboard(this)" data-link="http://chevrez-posts.onrender.com/posts/{{publi.id}}"><i class="fa-solid fa-share"></i></span>
      </div>
      <div class="comentarios">
        <div class="box-comentario">
          <span class="title-comment"><i class="fa-solid fa-comment-dots"></i> Agregar un comentario</span>
          <form action="/posts/{{publi._id}}/comment" class="text-post" id="form" method="POST">
            <textarea name="comment" class="comment-modal"></textarea>
            <button class="post-index"><i class="fa-solid fa-comment"></i> Publicar</button>
          </form>
        </div>
        <div class="list-comment">
          <div style="padding: 10px;">
            <span>Comentarios:</span>
          </div>
            {{#if comments.length}}
              {{#each comments}}
              <div class="comment-post">
                <span class="comment">[ {{this.fecha}} {{this.tiempo}} ] <span style="color: gold; font-weight: bold;">{{this.user_id.name}}</span>:</span>
                <span class="comment">{{this.comment}}</span>
              </div>
              {{/each}}
            {{else}}
              <p class="comment" style="margin-left: 10px;">No hay comentarios aÃºn</p>
            {{/if}}
        </div>
      </div>
    </div>
    <span class="foundation">Â© Chevrez 2024</span>
  </div>
  <!--BOX-LEFT-->
  <div class="box-left">
    <div class="left-box">
      <div class="anun">
        <span>Anuncio <i class="fa-solid fa-bell" style="color: gold;"></i></span>
        <hr/>
        <span class="parr2">La mecÃ¡nica de dar likes aun no funciona, solo puedes comentar y compartir.</span>
      </div>
    </div>
  </div>
</div>

<!-- FORM COMMENT -->
<div id="ex1" class="modal">
  <div class="aea2">
    <div class="image-public">
      <img src="http://gravatar.com/avatar/{{publi.user_id.gravatar}}?d=monsterid&s=300">
    </div>
    <div class="ga">
      <span class="info-public-name" id="info-publi">
        {{publi.user_id.name}}ðŸ—¿ <span class="info-public-name-arroba">@{{publi.user_id.name}}</span>
      </span>
      <span class="parr">{{publi.parr}}</span>

      <span class="respon_comment">Comentando a <span class="name-publi">{{publi.user_id.name}}</span></span>
    </div>
  </div>
  <hr/>
  <form action="/posts/{{publi._id}}/comment" id="form_modal" class="text-post" method="POST">
    <textarea id="area" class="modal-comment" name="comment"></textarea>
    <button class="btn-modal"><i class="fa-solid fa-comment"></i> Comentar</button>
  </form>
</div>

{{#if adminName}}
<div id="ex2" class="modal">
  <form action="/posts/{{publi._id}}?_method=DELETE" method="POST" onsubmit="return confirm('Â¿EstÃ¡s seguro de que deseas eliminar este post?');">
    <button class="delete" type="submit">Eliminar</button>
  </form>
</div>
{{/if}}

<script>
document.addEventListener('DOMContentLoaded', function() {
  const textarea = document.querySelector("textarea");
  const area = document.getElementById('area')
  
  textarea.addEventListener('blur', function() {
    textarea.value = textarea.value.trim();
  });

  area.addEventListener('blur', function() {
    area.value = area.value.trim();
  });

  const form = document.getElementById('form');
  const form_modal = document.getElementById('form_modal');
  form.addEventListener('submit', function(event) {
    textarea.value = textarea.value.trim();
  });
  form_modal.addEventListener('submit', function(event) {
    form_modal.value = area.value.trim();
  });
});

function copyLinkToClipboard(url) {
  var link = url.getAttribute("data-link");

  var tempInput = document.createElement("input");
  tempInput.value = link;
  document.body.appendChild(tempInput);
  tempInput.select();
  document.execCommand("copy");
  document.body.removeChild(tempInput);

  alert("Copiado al portapapeles, ahora puedes compartir el link");
}
</script>
</body>
</html>

